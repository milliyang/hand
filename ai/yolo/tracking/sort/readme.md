
### 算法组成
```

    1. Yolo 智能物体识别
    2. SORT 预测, IOU匹配, 分配ID
    3. SimTracker 相似性匹配, ID跟踪以及物体丢失后重新匹配
    4. 用户选择ID跟踪 (未做)

    * 注意:
        步骤2,3 各自维护一套独立Id分配. 如: id:[0-0] id:[1-0] id:[1-0], 表示步骤2 ID:0,1,2 都对应步骤3 ID:0
        步骤3 才是最终可见ID
```


### 算法介绍
```

    1. Yolo 人工智能物体识别
        - 只能识别特定物体(20项)
            - 人, 人脸，手，.. 其他待定
            - 手分不同的手势: 1,2,3,4,5,OK,  (还没做)
            - 人分为: 上半身, 下半身， (还没做)

        - 识别率 (需要通过增加训练集改善)
            - 以人脸识别为例子:
                正脸, 侧脸, 不同肤色, 不同亮度，带面罩, 小部分遮挡, 等
              上面举例, 都需要测试到, 并且有一个合理的评估

    2. SORT 预测, IOU匹配, 分配ID
        - 使用Kalman预测识别框.
            - 由于Yolo识别率(偶尔几帧无法识别) 或 识别框突变, 会导致Kalman失效, 最后引起Id丢失，重新分配

        - 根据Yolo识别框(x,y,w,h)的并交比(IOU), 来快速匹配，并且分配ID

        - 常见问题:
            - (已解决) 分类隔离, 即 不同列别的识别框就算重叠也不会混淆
            - Id 丢失
                - Kalman预测失败
                    - 通过限制识别框的变化率，或者最大最小改善 (未做)
                - 由于Yolo识别率 连续N帧无法识别丢失
                - 遮挡无法识别丢失

    3. SimTracker 相似性匹配, ID跟踪以及物体丢失后重新匹配
        - 修正 SORT 识别丢失问题
        - 解决丢失后, 通过图像相似性，重新匹配Id
            - 快速匹配
            - 相似性匹配
            - 安全状态下(IOU <0) 图像模型更新(SSIM)
            - 丢失后最大存活期( 90帧, 约3秒 )

```


### 算法评估
```

- 识别率评估:
    - 脸部识别率:
        - 不同光照、亮度
        - 不同肤色
        - 侧脸，低头，仰头
        - 旋转不同角度
        - 不同距离 (最大, 最小)
        - 部分遮挡:
            - 帽子
            - 眼镜
            - 口罩
            - 头发
        - 很多人脸时
        - 失焦,变焦后
        - 畸变: 图像不同区间：50% 60% 80% 90%, 边缘 识别率是否会不一致


    - 脸部失效案例:
        - 

    - 人识别率:
    - 人失效案例:
    - 人，手，其他


- 跟踪: (目前选择跟踪没实现，只评估步骤3中, ID是否一致)

    - 单物体跟踪: (每一类别只有一个物体)

        - 以下情况是否会跟丢:
            - 不同速度
            - 旋转导致跟丢
            - 无法识别导致跟丢
            - 环境、光照导致跟丢
            - 超出镜头
            - 偶尔遮挡

        - 跟丢后, 是否能够重新恢复

    - 多物体跟踪(不重叠)

    - 多物体跟踪(重叠，遮挡后, 在重新匹配)
        - 

```


### 后续安排
```
    1. Yolo识别 (20种) :
        - 增加手势的识别: 8 种
        - 增加 全身/躯干/上半身/下半身/头部/脸部 识别   6种
        - 脸部识别的优化:
            - 脸部识别框 是否包含 头发?
            - 是否增加眼镜识别
            - 是否增加帽子识别
            - 其他信息?

    2. 模型压缩测量:
        - 压缩模型后
        - 量化前后对比效果对比测试

    3. 跟踪模块优化
        - (closed) 特征识别算法比较: SSIM,  SIFT/OKB + Color
            - SIFT 更适合双目特征匹配，3D重建; 前后帧差异大，匹配太多误差, (不合适)
        - (closed) 判断识别框重叠条件: 采取upscale*=1.2方式,避免由于Yolo框遮挡时自动缩小,导致识别框一直变小,其实已经重叠了
            => 人脸时有用;  人形时, 没有必要;
        - (done) 长时间没有识别时, ID reset        =>30s
        - 仅人,人脸 支持相似性匹配; 其他类别只支持快速匹配跟踪 (避免数量多时, opencv mat计算消耗过多)

    4. 用户选择并且跟踪
        - 主目标丢失后，如何处理:
            - 什么条件判定为丢失
            - 丢失后，如何切换至下一个目标
                - 同类别就近 ?
                - 假如没有同类别时, 切换跟踪物体                                     =>不考虑
                - 假如没有同类别时，切换跟踪物体后, 如果相同类别出现，又该如何处理      =>不考虑

        - 允许用户输入ID/Rect
            - 使用按键触发, 如: F1 映射为跟踪
                - 按一下F1 显示可以跟踪的物体框
                - 继续按F1, 目标切换下一个物体
                - 等待3s后，开始跟踪最后选中的物体，一直显示跟踪框

    5. 自动对焦场景:
        - 处理逻辑

    6. 主跟踪物体, 优先比较:
        - 图像接近
        - IOU 接近

    7. 测试安排
        - 识别率测试
        - 单目标跟踪
        - 多目标情况下, 选择单目标跟踪
        - 多目标覆盖后，重新跟踪

    8. 问题:
        - 手势识别 因为size太小导致无法识别, 拉远了可以识别，拉近无法识别

        - 躯干、腿部 识别率不高
        - 椅子、特殊地方被识别为人(怎么改善?)
        - 脸部识别大小 (脸部太大，识别率会下降，估计是因为样本数据问题)


********
    - 构图选项: 特写,半身,全身
    - 手指识别: ON/OFF



./yolo darknet2caffe/yolov2.cut.prototxt darknet2caffe/yolov2.caffemodel ~/Downloads/wudao/multi.p5.sexyback.mp4 
./yolo darknet2caffe/imvt20_yolo2.cut.prototxt darknet2caffe/imvt20_yolo2.caffemodel /dev/video0

```